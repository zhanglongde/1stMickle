预发布
回源 用户源 中间源

[CDN知识详解](https://zhuanlan.zhihu.com/p/28939811)
[CDN是什么？使用CDN有什么优势？](https://www.zhihu.com/question/36514327/answer/68143522)

## 目的 ##
解决因**分布**、**带宽**、**服务器性能**带来的访问延迟问题，
使用户可就近取得所需内容，解决**网络拥挤状况**，
提高用户访问网站的**响应速度**和**成功率**

## 基础架构 ##
最简单的CDN网络由一个DNS服务器和几台缓存服务器组成
第一阶段 
通过本地DNS系统和CDN的DNS服务器得到**全局负载均衡设备IP地址**
1.经本地DNS系统解析，最终会将域名的解析权交给CNAME指向的CDN专用DNS服务器
  CDN加速后的域名，CNAME映射到本地DNS系统查询的末端
2.CDN的DNS服务器将CDN的全局负载均衡设备IP地址返回用户

第二阶段 简化为CDN内部行为？
通过全局负载均衡、区域负载均衡，得到**缓存服务器IP地址**
3.用户向CDN的全局负载均衡设备发起内容URL访问请求
4.CDN全局负载均衡设备根据用户IP地址、用户请求的内容URL
  选择一台用户所属区域的区域浮在均衡设备
5.区域负载均衡设备为用户选择一台合适的缓存服务器提供服务
6.全局负载均衡设备把服务器的IP地址返回给用户

第三阶段 用户向最终IP请求
7.用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。



## 动静分离架构 VS 使用CDN服务的架构 ##
### 动静分离架构 ###
ISP之间的通信互联成为影响静态资源加载速度的一个重要瓶颈
没有CDN的web请求过程，主要分为两步：1. 域名服务器解析IP地址 ；2. 和目标机器建立连接请求资源。

在域名解析的过程中，由于域名和IP映射存储在server-isp-DNS服务器(**A记录解析**)，发起请求之后，需要通过根域名服务器依次迭代查询。最后返回源站的IP地址给客户端，开始建立连接请求资源。
### 使用CDN服务的架构 ###
server-isp-DNS服务器不是直接把域名做A记录映射到源站，而是**CNAME记录到调度中心**，调度中心根据用户请求的来源，选择一个最近的CDN节点的IP地址（通常是虚拟IP地址）。
用户和CDN节点IP地址建立连接开始请求资源，CDN节点内部进行负载均衡后，负责响应的机器查询是否有该资源（**第一次请求的延时和没有使用CDN服务是一样的**），如果没有则回源站进行请求（同时进行缓存），然后响应请求。

减少了ISP之间通信的过程