/** 
 * imglazyload(include loadScript) v1.2 for jQuery
 * Author : chenmnkken@gmail.com
 * Url : http://stylechen.com/rewrite-documentwrite.html
 * Url : http://stylechen.com/imglazyload2.html
 * Date : 2012-04-02
 */
(function(g){g.fn.imglazyload=function(m){var i=g.extend({attr:"lazy-src",container:window,event:"scroll",fadeIn:false,threshold:0,vertical:true,loadScript:false},m);m=i.event;var n=i.vertical,e=g(i.container),q=i.threshold,r=i.loadScript,j=g.makeArray(g(this)),t=n?"top":"left",s=n?"scrollTop":"scrollLeft",u=n?e.height():e.width(),v=e[s](),y=u+v,k=[],z=function(a){k.push(a);k[0]!=="runing"&&w()},w=function(){var a=k.shift();if(a==="runing")a=k.shift();if(a){k.unshift("runing");a()}},A=function(a){var d=
a.value.match(/src="([\s\S]*?)"/i)[1],h=a.parentNode,o=document.write,b=document.createElement("script"),f=document.head||document.getElementsByTagName("head")[0]||document.documentElement;document.write=function(c){h.innerHTML=c};b.type="text/javascript";b.src=d;b.onerror=b.onload=b.onreadystatechange=function(c){c=c||window.event;if(!b.readyState||/loaded|complete/.test(b.readyState)||c==="error"){document.write=o;f.removeChild(b);f=h=a=b=b.onerror=b.onload=b.onreadystatechange=null;w()}};f.insertBefore(b,
f.firstChild)},B={init:function(a){return a>=v&&a<=y+q},scroll:function(a){var d=e[s]();return a>=d&&a<=u+d+q},resize:function(a){var d=e[s](),h=n?e.height():e.width();return a>=d&&a<=h+d+q}},x=function(a,d){var h=0,o=false,b,f,c,p;if(d){if(d!=="scroll"&&d!=="resize")o=true}else d="init";for(;h<j.length;h++){b=false;f=j[h];c=g(f);if(!r){p=c.attr(i.attr);if(!p||f.src===p)continue}b=c.data("imglazyload_offset");if(b===undefined){b=r?c.parent().offset()[t]:c.offset()[t];c.data("imglazyload_offset",b)}if(b=
o||B[d](b)){if(r)(function(C){z(function(){A(C)})})(f);else{f.src=p;i.fadeIn&&c.hide().fadeIn()}c.removeData("imglazyload_offset");j.splice(h--,1)}}if(!j.length){a?a.unbind(d,l):e.unbind(i.event,l);g(window).unbind("resize",l);j=null}f=c=null},l=function(a){x(g(this),a.type)};e=m==="scroll"?e:g(this);e.bind(m,l);g(window).bind("resize",l);x();return this}})(jQuery);
